<!DOCTYPE html>
<html>
<head>
	<title>Radar with Multiple Dots</title>
	<style type="text/css">
		#radar {
			position:relative;
			width:400px;
			height:400px;
			margin:20px auto;
			border:3px solid #0c0;
			background-color:#020;
			border-radius:0%;
		}
		#radar>* { position: absolute; }
		.beacon {
			left: 50%;
			top: 50%;
			border-style: solid;
			border-width: 8px 200px 8px 0;
			border-color: transparent;
			margin-top: -8px;
			transform-origin: 0 50%;
		}
		#beacon {border-right-color:#0c0; animation: spin 15s 0s linear infinite;}
        #beacon-25 {border-right-color: rgba(0,204,0,0.25); animation: spin 15s 0.09s linear infinite;}
		#beacon-50 {border-right-color: rgba(0,204,0,0.5); animation: spin 15s 0.06s linear infinite;}
        #beacon-75 {border-right-color: rgba(0,204,0,0.75); animation: spin 15s 0.06s linear infinite;}
		
		.circle {
			left: 50%;
			top: 50%;
			border: 1px solid #0c0;
			border-radius: 50%;
		}
		#circle-big { width: 300px; height: 300px; margin: -150px; }
		#circle-medium { width: 200px; height: 200px; margin: -100px; }
		#circle-small { width: 100px; height: 100px; margin: -50px; }
		.dot {
			width: 10px;
			height: 10px;
			background-color: #ffffff;
			border-radius: 50%;
			animation: blink 1.5s linear infinite;
		}
		#vertical {
			left: 50%;
			top: 0;
			bottom: 0;
			border-left: 1px solid #0c0;
		}
		#horizontal {
			top: 50%;
			left: 0;
			right: 0;
			border-top: 1px solid #0c0;
		}

		@keyframes spin {
			from { transform: rotate(0); }
			to { transform: rotate(360deg); }
		}

		@keyframes blink {
			0% { opacity: 0.3; }
			50% { opacity: 1; }
			100% { opacity: 0.3; }
		}
	</style>
</head>
<body>
	<div id="radar">
		<div class="beacon" id="beacon"></div>
		<div class="beacon" id="beacon-25"></div>
		<div class="beacon" id="beacon-50"></div>
        <div class="beacon" id="beacon-75"></div>		
		<div class="circle" id="circle-big"></div>
		<div class="circle" id="circle-medium"></div>
		<div class="circle" id="circle-small"></div>
		<div id="vertical"></div>
		<div id="horizontal"></div>
		
		<!-- <div class="dot" style="top: 50%; left: 10%;"></div> -->
		

		<!-- Add more dots here -->
	</div>
</body>

  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDRZfCQmKFdjUwuW-lq4P5S3k2wntpP26E",
      authDomain: "wifiscanfirebase.firebaseapp.com",
      databaseURL: "https://wifiscanfirebase-default-rtdb.firebaseio.com",
      projectId: "wifiscanfirebase",
      storageBucket: "wifiscanfirebase.appspot.com",
      messagingSenderId: "586448397048",
      appId: "1:586448397048:web:dea539e352789765a1910d",
      measurementId: "G-CZXPR54MTV"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Reference to sensor data
    const distanceDataRef = ref(database, '/sensorData/distance');
    const servoAngleDataRef = ref(database, '/sensorData/servoAngle');

    // Function to add a dot to the radar based on angle and distance
    function addDotToRadar(servoAngle, distance) {
      const radar = document.getElementById('radar');
      const radarSize = radar.offsetWidth;  // Radar size (400px)

      // Limit maximum distance to 400 cm and scale it to 200px
      const maxDistance = radarSize / 2;  // Radius of the radar in pixels (200px)
      const distanceInPixels = Math.min(distance, 400) / 400 * maxDistance;  // Convert distance to pixels

      // Convert angle to radians (adjust to start from top)
      const angleInRadians = (servoAngle - 90) * Math.PI / 180;
      const x = distanceInPixels * Math.cos(angleInRadians);
      const y = distanceInPixels * Math.sin(angleInRadians);

      // Calculate the position of the dot in percentages
      const leftPercent = 50 + (x / radarSize) * 100;  // 50% for the center
      const topPercent = 50 - (y / radarSize) * 100;   // 50% for the center

      // Create the dot element and add it to the radar
      const dot = document.createElement('div');
      dot.classList.add('dot');
      dot.style.left = `${leftPercent}%`;
      dot.style.top = `${topPercent}%`;

      radar.appendChild(dot);
    }

    // Listen to changes in distance and servoAngle data from Firebase
    onValue(distanceDataRef, (snapshot) => {
      const distance = snapshot.val();
      const servoAngleSnapshot = ref(database, '/sensorData/servoAngle');
      onValue(servoAngleSnapshot, (angleSnapshot) => {
        const servoAngle = angleSnapshot.val();
        
        if (distance !== null && servoAngle !== null) {
          addDotToRadar(servoAngle, distance);  // Add dot based on sensor data
        }
      });
    });
  </script>
</html>
