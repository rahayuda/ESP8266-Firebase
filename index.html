<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Sensor Data with Radar</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Chart.js library -->
</head>
<body>
  <h1>Firebase Sensor Data</h1>
  
  <h2>Distance Sensor Radar</h2>
  <canvas id="radarChart" width="400" height="400"></canvas>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDRZfCQmKFdjUwuW-lq4P5S3k2wntpP26E",
      authDomain: "wifiscanfirebase.firebaseapp.com",
      databaseURL: "https://wifiscanfirebase-default-rtdb.firebaseio.com",
      projectId: "wifiscanfirebase",
      storageBucket: "wifiscanfirebase.appspot.com",
      messagingSenderId: "586448397048",
      appId: "1:586448397048:web:dea539e352789765a1910d",
      measurementId: "G-CZXPR54MTV"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const distanceDataRef = ref(database, '/sensorData/distance');
    const servoAngleDataRef = ref(database, '/sensorData/servoAngle');

    const ctx = document.getElementById('radarChart').getContext('2d');
    let radarChart;

    // Initialize radar chart
    function createRadarChart(distance, servoAngle) {
      if (radarChart) {
        radarChart.destroy();  // Destroy the previous chart before creating a new one
      }

      // Convert servo angle to radians for chart calculation
      const angleInRadians = (servoAngle % 360) * (Math.PI / 180); // Convert degrees to radians

      radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['North', 'East', 'South', 'West'], // Labels for directions
          datasets: [{
            label: 'Distance Sensor Data',
            data: [
              distance * Math.cos(angleInRadians),   // North
              distance * Math.sin(angleInRadians),   // East
              distance * Math.cos(angleInRadians + Math.PI), // South
              distance * Math.sin(angleInRadians + Math.PI)  // West
            ], 
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          animation: {
            duration: 0  // Set animation duration to 0 for smooth updates
          },
          scales: {
            r: {
              suggestedMin: 0,
              suggestedMax: 100 // Adjust as needed for sensor range
            }
          }
        }
      });
    }

    // Function to update radar chart every time the data changes
    function updateRadarChart() {
      onValue(distanceDataRef, (snapshot) => {
        const distance = snapshot.val();
        const servoAngleSnapshot = ref(database, '/sensorData/servoAngle');
        onValue(servoAngleSnapshot, (angleSnapshot) => {
          const servoAngle = angleSnapshot.val();
          if (distance !== null && servoAngle !== null) {
            createRadarChart(distance, servoAngle);
          }
        });
      });
    }

    // Set an interval to continuously update the chart with data from Firebase
    setInterval(updateRadarChart, 1000); // Update chart every second

  </script>
</body>
</html>
